# API 設計（PoC 版）

## 概要

この API 設計は、React Native の iOS アプリのための Firebase 連携関数を定義します。PoC 版では Firebase Firestore を使用したクラウドデータ操作 API を構築します。

## データアクセス API

### 認証関連

- `registerUser(email, password)` - ユーザー登録
- `loginUser(email, password)` - ログイン
- `logoutUser()` - ログアウト
- `getCurrentUser()` - 現在のユーザー情報取得

### 書籍関連

- `addBook(bookData)` - 新規書籍を追加
- `updateBook(id, bookData)` - 書籍情報を更新
- `getAllBooks(userId)` - ユーザーの全書籍を取得
- `getBookById(id)` - 特定の書籍を ID で取得
- `deleteBook(id)` - 書籍を削除

### 進捗管理

- `updateBookProgress(id, currentPage)` - 読書進捗を更新
- `calculateProgress(currentPage, totalPages)` - 進捗率（％）を計算
- `logReadingSession(bookId, pagesRead, readingTime)` - 読書セッションを記録

### 統計関連

- `getReadingStats(userId)` - 読書統計を取得（総読了ページ数、完読冊数など）
- `getTotalPagesRead(userId)` - 全書籍の読了ページ合計を計算
- `getReadingStreak(userId)` - 連続読書日数を計算

## リクエストとレスポンス例

### addBook(bookData)

**リクエスト**

```javascript
const bookData = {
  title: "プログラミング言語の基礎",
  author: "山田太郎",
  totalPages: 450,
  currentPage: 0,
  coverImage: null, // オプション：画像データまたはURL
  startDate: new Date(),
  userId: "currentUserID",
};
```

**レスポンス**

```javascript
{
  id: "generatedBookId", // Firestoreで生成されたドキュメントID
  success: true
}
```

### updateProgress(bookId, currentPage)

**リクエスト**

```javascript
const bookId = "existingBookId";
const currentPage = 120;
```

**レスポンス**

```javascript
{
  success: true,
  progress: 26.67, // 計算された読了率（％）
  updatedAt: "2025-05-26T12:30:45Z"
}
```

### getReadingStats(userId)

**リクエスト**

```javascript
const userId = "currentUserID";
```

**レスポンス**

```javascript
{
  totalBooks: 5,
  completedBooks: 2,
  inProgressBooks: 3,
  totalPagesRead: 1250,
  averageProgress: 65.3, // パーセンテージ
  readingStreakDays: 7
}
```

## エラーハンドリング

すべての API 呼び出しは以下のようなエラーレスポンスを返す可能性があります：

```javascript
{
  error: true,
  code: "auth/user-not-found",
  message: "指定されたユーザーが見つかりません。",
}
```

## バッチ処理とトランザクション

データの整合性が必要な場合は、Firestore のバッチ処理やトランザクションを活用します：

```javascript
// バッチ処理の例
const batch = firestore.batch();
// 複数の書籍のステータスを一括更新
booksToUpdate.forEach((book) => {
  const bookRef = firestore.collection("books").doc(book.id);
  batch.update(bookRef, { status: "archived" });
});
await batch.commit();
```

<!-- Generated by Copilot -->
