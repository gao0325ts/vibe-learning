# API 設計（PoC 版 - Web アプリ / 初心者向けシンプル構成）

## 概要

この API 設計は、React Web アプリのための Firebase 連携関数を定義します。PoC 版では Firebase Firestore を使用したシンプルなデータ操作 API を構築し、初心者でも理解しやすい関数名と処理にしています。

## データアクセス API（初心者向けシンプル版）

### 認証関連（Firebase Authentication）

- `signUpUser(email, password)` - 新規ユーザー登録
- `signInUser(email, password)` - ユーザーログイン
- `signOutUser()` - ログアウト
- `getCurrentUser()` - 現在ログイン中のユーザー情報取得

### 書籍関連（基本的な CRUD 操作）

- `addBook(bookData)` - 新しい書籍を追加
- `getAllBooks(userId)` - ユーザーの全書籍を取得
- `updateBook(bookId, updateData)` - 書籍情報を更新
- `deleteBook(bookId)` - 書籍を削除

### 読書進捗関連（シンプルな進捗管理）

- `updateProgress(bookId, currentPage)` - 読書進捗を更新
- `markAsCompleted(bookId)` - 書籍を完読に設定
- `getReadingStats(userId)` - 読書統計を取得（総書籍数、完読数など）

### ローカルストレージ関連（ブラウザ用）

- `saveToLocal(key, data)` - ローカルストレージに保存
- `getFromLocal(key)` - ローカルストレージから取得
- `clearLocal(key)` - ローカルストレージから削除

## リクエストとレスポンス例（初心者向け）

### signUpUser(email, password)

**リクエスト**

```javascript
// 新規ユーザー登録
const email = "user@example.com";
const password = "password123";

try {
  const result = await signUpUser(email, password);
  console.log("登録成功:", result);
} catch (error) {
  console.log("登録失敗:", error.message);
}
```

**レスポンス**

```javascript
// 成功時
{
  success: true,
  user: {
    uid: "firebase_user_id",
    email: "user@example.com"
  }
}

// エラー時
{
  success: false,
  error: "メールアドレスが既に使用されています"
}
```

### addBook(bookData)

**リクエスト**

```javascript
// 新しい書籍を追加
const bookData = {
  title: "JavaScript の基本",
  author: "田中花子",
  totalPages: 200,
  currentPage: 0,
  memo: "プログラミング学習用"
};

try {
  const result = await addBook(bookData);
  console.log("書籍追加成功:", result);
} catch (error) {
  console.log("書籍追加失敗:", error.message);
}
```

**レスポンス**

```javascript
// 成功時
{
  success: true,
  bookId: "book_001",
  message: "書籍が正常に追加されました"
}
```

### updateProgress(bookId, currentPage)

**リクエスト**

```javascript
// 読書進捗を更新
const bookId = "book_001";
const currentPage = 45;

try {
  const result = await updateProgress(bookId, currentPage);
  console.log("進捗更新成功:", result);
} catch (error) {
  console.log("進捗更新失敗:", error.message);
}
```

**レスポンス**

```javascript
// 成功時
{
  success: true,
  currentPage: 45,
  progressPercent: 22.5, // 45/200 * 100
  message: "読書進捗が更新されました"
}
```

### getReadingStats(userId)

**リクエスト**

```javascript
// 読書統計を取得
const userId = getCurrentUser().uid;

try {
  const stats = await getReadingStats(userId);
  console.log("統計データ:", stats);
} catch (error) {
  console.log("統計取得失敗:", error.message);
}
```

**レスポンス**

```javascript
// 成功時
{
  totalBooks: 3,        // 登録書籍数
  completedBooks: 1,    // 完読書籍数
  totalPages: 89,       // 総読了ページ数
  booksInProgress: 2    // 読書中の書籍数
}
```

## エラーハンドリング（初心者向け）

### 基本的なエラーパターン

```javascript
// 認証エラー
{
  success: false,
  error: "auth/user-not-found",
  message: "ユーザーが見つかりません"
}

// ネットワークエラー
{
  success: false,
  error: "network-error",
  message: "インターネット接続を確認してください"
}

// データ不足エラー
{
  success: false,
  error: "validation-error",
  message: "書籍タイトルが入力されていません"
}
```

### エラーハンドリングの実装例

```javascript
// 基本的なエラーハンドリング
async function handleAddBook(bookData) {
  try {
    const result = await addBook(bookData);
    if (result.success) {
      alert("書籍が追加されました！");
    }
  } catch (error) {
    console.error("エラー:", error);
    alert("書籍の追加に失敗しました: " + error.message);
  }
}
```

## ローカルストレージの活用（初心者向け）

### 基本的な使用例

```javascript
// ユーザー設定の保存
function saveUserSettings(settings) {
  localStorage.setItem('userSettings', JSON.stringify(settings));
}

// ユーザー設定の取得
function getUserSettings() {
  const settings = localStorage.getItem('userSettings');
  return settings ? JSON.parse(settings) : null;
}

// 一時的なデータの保存（書きかけのメモなど）
function saveTempData(key, data) {
  sessionStorage.setItem(key, JSON.stringify(data));
}
```

## Firebase 設定（Windows 環境向け）

### プロジェクト設定ファイル例

```javascript
// firebase-config.js（初心者向けシンプル版）
import { initializeApp } from 'firebase/app';
import { getFirestore } from 'firebase/firestore';
import { getAuth } from 'firebase/auth';

// Firebase 設定（実際の値は Firebase Console から取得）
const firebaseConfig = {
  apiKey: "your-api-key",
  authDomain: "your-project.firebaseapp.com",
  projectId: "your-project-id",
  storageBucket: "your-project.appspot.com",
  messagingSenderId: "123456789",
  appId: "your-app-id"
};

// Firebase 初期化
const app = initializeApp(firebaseConfig);
export const db = getFirestore(app);
export const auth = getAuth(app);
```

## API 使用時の注意点（初心者向け）

### セキュリティ
- **API キーは公開リポジトリにコミットしない**
- **環境変数（.env ファイル）を活用**
- **Firestore セキュリティルールを適切に設定**

### パフォーマンス
- **必要なデータのみ取得**（全件取得を避ける）
- **ローカルキャッシュの活用**
- **ページング機能の実装**（大量データ対応）

### エラー対応
- **try-catch で確実にエラーハンドリング**
- **ユーザーにわかりやすいエラーメッセージ表示**
- **console.log でデバッグ情報を出力**

<!-- Generated by Copilot -->
