# API 設計

## 概要

この API は、ReactNative の iOS アプリと Firebase のサービス間の通信を定義します。Firebase Authentication 及び Firebase Firestore を使用した読書進捗管理アプリのための API です。

## Firebase Authentication API

### 認証関連

- `createUserWithEmailAndPassword(email, password)` - ユーザー登録
- `signInWithEmailAndPassword(email, password)` - ログイン
- `signOut()` - ログアウト
- `getCurrentUser()` - 現在のユーザー取得
- `updateUserProfile(displayName, photoURL)` - ユーザープロファイル更新
- `sendPasswordResetEmail(email)` - パスワードリセットメール送信
- `deleteUser()` - ユーザー削除

## Firestore API

### 書籍関連

- `addBook(bookData)` - 書籍を追加
- `getBooks(userId)` - ユーザーの全書籍を取得
- `getBook(bookId)` - 特定の書籍を取得
- `updateBook(bookId, bookData)` - 書籍情報を更新
- `updateProgress(bookId, currentPage)` - 読書進捗を更新
- `deleteBook(bookId)` - 書籍を削除

### 統計関連

- `getReadingStats(userId)` - 読書統計を取得
- `getDailyReadingLog(userId, startDate, endDate)` - 日別の読書ログを取得

## リクエストとレスポンス例

### addBook(bookData)

**リクエスト**

```javascript
const bookData = {
  title: "プログラミング言語の基礎",
  author: "山田太郎",
  totalPages: 450,
  currentPage: 0,
  coverImage: null, // オプション：画像データまたはURL
  startDate: new Date(),
  userId: "currentUserID",
};
```

**レスポンス**

```javascript
{
  id: "generatedBookId", // Firestoreで生成されたドキュメントID
  success: true
}
```

### updateProgress(bookId, currentPage)

**リクエスト**

```javascript
const bookId = "existingBookId";
const currentPage = 120;
```

**レスポンス**

```javascript
{
  success: true,
  progress: 26.67, // 計算された読了率（％）
  updatedAt: "2025-05-26T12:30:45Z"
}
```

### getReadingStats(userId)

**リクエスト**

```javascript
const userId = "currentUserID";
```

**レスポンス**

```javascript
{
  totalBooks: 5,
  completedBooks: 2,
  inProgressBooks: 3,
  totalPagesRead: 1250,
  averageProgress: 65.3, // パーセンテージ
  readingStreakDays: 7
}
```

## エラーハンドリング

すべての API 呼び出しは以下のようなエラーレスポンスを返す可能性があります：

```javascript
{
  error: true,
  code: "auth/user-not-found",
  message: "指定されたユーザーが見つかりません。",
}
```

## バッチ処理とトランザクション

データの整合性が必要な場合は、Firestore のバッチ処理やトランザクションを活用します：

```javascript
// バッチ処理の例
const batch = firestore.batch();
// 複数の書籍のステータスを一括更新
booksToUpdate.forEach((book) => {
  const bookRef = firestore.collection("books").doc(book.id);
  batch.update(bookRef, { status: "archived" });
});
await batch.commit();
```

<!-- Generated by Copilot -->
